<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 400">
  <defs>
    <linearGradient id="hGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f472b6"/>
      <stop offset="100%" style="stop-color:#db2777"/>
    </linearGradient>
    <filter id="shd2">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="400" fill="#0f172a"/>
  
  <!-- Main container -->
  <rect x="30" y="20" width="840" height="360" rx="16" fill="#1e293b" filter="url(#shd2)"/>
  
  <!-- Header -->
  <rect x="30" y="20" width="840" height="55" rx="16" fill="url(#hGrad)"/>
  <rect x="30" y="55" width="840" height="20" fill="url(#hGrad)"/>
  <text x="450" y="55" font-family="Arial, sans-serif" font-size="20" fill="#fff" text-anchor="middle" font-weight="bold" dominant-baseline="middle">
    Formula 2: Hardware-efficient Decoding Stage
  </text>
  
  <!-- Info banner -->
  <rect x="50" y="95" width="800" height="35" rx="8" fill="#1e3a5f"/>
  <text x="450" y="115" font-family="Arial" font-size="13" fill="#f472b6" text-anchor="middle" dominant-baseline="middle">
    Decoding: Process one token at a time (autoregressive generation)
  </text>
  
  <!-- Line 1: KV preprocessing -->
  <rect x="50" y="145" width="380" height="85" rx="10" fill="#0f172a" stroke="#f472b6" stroke-width="2"/>
  <text x="240" y="170" font-family="Arial" font-size="13" fill="#f472b6" text-anchor="middle" font-weight="bold" dominant-baseline="middle">KV Cache Update</text>
  
  <text x="80" y="210" font-family="serif" font-size="26" fill="#fbbf24" font-style="italic" dominant-baseline="middle">K̂</text>
  <text x="110" y="210" font-family="serif" font-size="26" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="135" y="210" font-family="serif" font-size="26" fill="#4ade80" font-style="italic" dominant-baseline="middle">V̂</text>
  <text x="175" y="210" font-family="serif" font-size="26" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="215" y="210" font-family="serif" font-size="20" fill="#a78bfa" dominant-baseline="middle">Ψ(K)</text>
  <text x="285" y="210" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="315" y="210" font-family="serif" font-size="20" fill="#f97316" dominant-baseline="middle">Θ(V)</text>
  
  <!-- Line 2: Single query attention -->
  <rect x="470" y="145" width="380" height="85" rx="10" fill="#0f172a" stroke="#f472b6" stroke-width="2"/>
  <text x="660" y="170" font-family="Arial" font-size="13" fill="#f472b6" text-anchor="middle" font-weight="bold" dominant-baseline="middle">Single Query Attention</text>
  
  <text x="500" y="210" font-family="serif" font-size="22" fill="#f8fafc" font-style="italic" dominant-baseline="middle">s</text>
  <text x="520" y="210" font-family="serif" font-size="22" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="550" y="210" font-family="serif" font-size="22" fill="#f472b6" font-style="italic" dominant-baseline="middle">q</text>
  <text x="575" y="210" font-family="serif" font-size="22" fill="#fbbf24" font-style="italic" dominant-baseline="middle">K̂</text>
  <text x="605" y="195" font-family="serif" font-size="14" fill="#fbbf24" font-style="italic" dominant-baseline="middle">T</text>
  
  <!-- Full formula row -->
  <rect x="50" y="250" width="800" height="65" rx="10" fill="#1e3a5f"/>
  
  <text x="80" y="287" font-family="serif" font-size="24" fill="#f8fafc" font-style="italic" dominant-baseline="middle">s</text>
  <text x="105" y="287" font-family="serif" font-size="24" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="135" y="287" font-family="serif" font-size="24" fill="#f472b6" font-style="italic" dominant-baseline="middle">q</text>
  <text x="160" y="287" font-family="serif" font-size="24" fill="#fbbf24" font-style="italic" dominant-baseline="middle">K̂</text>
  <text x="190" y="272" font-family="serif" font-size="14" fill="#fbbf24" font-style="italic" dominant-baseline="middle">T</text>
  
  <text x="230" y="287" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">,</text>
  
  <text x="280" y="287" font-family="serif" font-size="24" fill="#f8fafc" font-style="italic" dominant-baseline="middle">p</text>
  <text x="305" y="287" font-family="serif" font-size="24" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="350" y="287" font-family="serif" font-size="18" fill="#a78bfa" dominant-baseline="middle">softmax</text>
  <text x="440" y="287" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">(s)</text>
  
  <text x="500" y="287" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">,</text>
  
  <text x="550" y="287" font-family="serif" font-size="24" fill="#f8fafc" font-style="italic" dominant-baseline="middle">o</text>
  <text x="580" y="287" font-family="serif" font-size="24" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="620" y="287" font-family="serif" font-size="24" fill="#f8fafc" font-style="italic" dominant-baseline="middle">p</text>
  <text x="650" y="287" font-family="serif" font-size="24" fill="#4ade80" font-style="italic" dominant-baseline="middle">V̂</text>
  
  <!-- Key insight -->
  <rect x="50" y="330" width="800" height="40" rx="8" fill="#0f172a" stroke="#334155" stroke-width="1"/>
  <text x="450" y="355" font-family="Arial" font-size="12" fill="#94a3b8" text-anchor="middle" dominant-baseline="middle">
    Methods: FlashDecoding (split KV) | KVQuant (INT2/3/4) | KiVi (INT2) | PagedAttention (memory realloc)
  </text>
</svg>
