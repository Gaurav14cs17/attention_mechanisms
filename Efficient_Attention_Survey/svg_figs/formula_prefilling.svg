<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 500">
  <defs>
    <linearGradient id="hdrGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#06b6d4"/>
      <stop offset="100%" style="stop-color:#3b82f6"/>
    </linearGradient>
    <filter id="shd">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="500" fill="#0f172a"/>
  
  <!-- Main container -->
  <rect x="30" y="20" width="840" height="460" rx="16" fill="#1e293b" filter="url(#shd)"/>
  
  <!-- Header -->
  <rect x="30" y="20" width="840" height="55" rx="16" fill="url(#hdrGrad)"/>
  <rect x="30" y="55" width="840" height="20" fill="url(#hdrGrad)"/>
  <text x="450" y="55" font-family="Arial, sans-serif" font-size="20" fill="#fff" text-anchor="middle" font-weight="bold" dominant-baseline="middle">
    Formula 1: Hardware-efficient Prefilling Stage
  </text>
  
  <!-- Step 1 -->
  <rect x="50" y="95" width="390" height="110" rx="12" fill="#0f172a" stroke="#06b6d4" stroke-width="2"/>
  <text x="245" y="120" font-family="Arial" font-size="14" fill="#06b6d4" text-anchor="middle" font-weight="bold" dominant-baseline="middle">Step 1: Preprocessing</text>
  
  <text x="70" y="165" font-family="serif" font-size="26" fill="#f472b6" font-style="italic" dominant-baseline="middle">Q̂</text>
  <text x="100" y="165" font-family="serif" font-size="26" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="120" y="165" font-family="serif" font-size="26" fill="#fbbf24" font-style="italic" dominant-baseline="middle">K̂</text>
  <text x="150" y="165" font-family="serif" font-size="26" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="170" y="165" font-family="serif" font-size="26" fill="#4ade80" font-style="italic" dominant-baseline="middle">V̂</text>
  <text x="210" y="165" font-family="serif" font-size="26" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="250" y="165" font-family="serif" font-size="20" fill="#a78bfa" dominant-baseline="middle">Ψ(Q)</text>
  <text x="315" y="165" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="335" y="165" font-family="serif" font-size="20" fill="#a78bfa" dominant-baseline="middle">Ψ(K)</text>
  <text x="400" y="165" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">,</text>
  <text x="420" y="165" font-family="serif" font-size="20" fill="#f97316" dominant-baseline="middle">Θ(V)</text>
  
  <!-- Step 2 -->
  <rect x="460" y="95" width="390" height="110" rx="12" fill="#0f172a" stroke="#06b6d4" stroke-width="2"/>
  <text x="655" y="120" font-family="Arial" font-size="14" fill="#06b6d4" text-anchor="middle" font-weight="bold" dominant-baseline="middle">Step 2: Attention Scores</text>
  
  <text x="500" y="165" font-family="serif" font-size="28" fill="#f8fafc" font-style="italic" dominant-baseline="middle">S</text>
  <text x="530" y="165" font-family="serif" font-size="28" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="570" y="165" font-family="serif" font-size="28" fill="#f472b6" font-style="italic" dominant-baseline="middle">Q̂</text>
  <text x="605" y="165" font-family="serif" font-size="28" fill="#fbbf24" font-style="italic" dominant-baseline="middle">K̂</text>
  <text x="640" y="150" font-family="serif" font-size="16" fill="#fbbf24" font-style="italic" dominant-baseline="middle">T</text>
  <text x="670" y="165" font-family="serif" font-size="24" fill="#64748b" dominant-baseline="middle">/</text>
  <text x="700" y="165" font-family="serif" font-size="22" fill="#22d3ee" dominant-baseline="middle">√d</text>
  
  <!-- Step 3 -->
  <rect x="50" y="225" width="390" height="110" rx="12" fill="#0f172a" stroke="#06b6d4" stroke-width="2"/>
  <text x="245" y="250" font-family="Arial" font-size="14" fill="#06b6d4" text-anchor="middle" font-weight="bold" dominant-baseline="middle">Step 3: Softmax + Postprocess</text>
  
  <text x="90" y="295" font-family="serif" font-size="28" fill="#f8fafc" font-style="italic" dominant-baseline="middle">P̂</text>
  <text x="130" y="295" font-family="serif" font-size="28" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="170" y="295" font-family="serif" font-size="20" fill="#f97316" dominant-baseline="middle">Θ</text>
  <text x="195" y="295" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">(</text>
  <text x="230" y="295" font-family="serif" font-size="18" fill="#a78bfa" dominant-baseline="middle">softmax</text>
  <text x="320" y="295" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">(</text>
  <text x="345" y="295" font-family="serif" font-size="20" fill="#f8fafc" font-style="italic" dominant-baseline="middle">S</text>
  <text x="365" y="295" font-family="serif" font-size="20" fill="#64748b" dominant-baseline="middle">))</text>
  
  <!-- Step 4 -->
  <rect x="460" y="225" width="390" height="110" rx="12" fill="#0f172a" stroke="#06b6d4" stroke-width="2"/>
  <text x="655" y="250" font-family="Arial" font-size="14" fill="#06b6d4" text-anchor="middle" font-weight="bold" dominant-baseline="middle">Step 4: Compute Output</text>
  
  <text x="580" y="295" font-family="serif" font-size="36" fill="#f8fafc" font-style="italic" dominant-baseline="middle">O</text>
  <text x="625" y="295" font-family="serif" font-size="36" fill="#64748b" dominant-baseline="middle">=</text>
  <text x="670" y="295" font-family="serif" font-size="36" fill="#f8fafc" font-style="italic" dominant-baseline="middle">P̂</text>
  <text x="715" y="295" font-family="serif" font-size="36" fill="#4ade80" font-style="italic" dominant-baseline="middle">V̂</text>
  
  <!-- Legend -->
  <rect x="50" y="355" width="800" height="110" rx="12" fill="#1e3a5f"/>
  
  <text x="80" y="385" font-family="serif" font-size="22" fill="#a78bfa" dominant-baseline="middle">Ψ</text>
  <text x="105" y="385" font-family="Arial" font-size="13" fill="#94a3b8" dominant-baseline="middle">= Q,K preprocess (quantize to INT8, FP8)</text>
  
  <text x="450" y="385" font-family="serif" font-size="22" fill="#f97316" dominant-baseline="middle">Θ</text>
  <text x="475" y="385" font-family="Arial" font-size="13" fill="#94a3b8" dominant-baseline="middle">= V/P postprocess (quantize)</text>
  
  <rect x="80" y="410" width="740" height="40" rx="8" fill="#065f46" stroke="#10b981" stroke-width="1"/>
  <text x="450" y="435" font-family="monospace" font-size="14" fill="#6ee7b7" text-anchor="middle" dominant-baseline="middle">
    ✓ Result: Exact attention with O(N) memory instead of O(N²)
  </text>
</svg>
